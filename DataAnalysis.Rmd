---
title: "datanalysis"
author: "Shamira Venturini"
date: "6/1/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```



```{r}
library("tidyverse")
library("dplyr")
library("Rmisc")
library("tidyr")
library("lme4")
library(plyr)
library(readr)
library(ggplot2)
library(GGally)
library(mlbench)
library(caret) 
library("devtools")
library(ggeffects)

```


```{r}
setwd("/Users/shamiraventurini/Desktop/Pilot")
data <- read.csv("./PilotData.csv")
mydf <- read.table("./PilotData.csv", sep = ',', header = TRUE) 
data <- as_tibble(mydf) 
data
```

There are 77 participants
```{r}
data$X<-NULL

length(unique(data$Subject))

```

```{r}
summary(data$Age)
summary(data$MTELP)
```

Correlation: MTELP + listening skills don't correlate: 0.47 - MTELP only

```{r}
cor(data$MTELP, data$Skills,  method = "pearson", use = "complete.obs") #0.46 (low) - I'll use MTELP only
```


Group by condition
```{r}

autocc <-subset(data, Condition == "auto_cc")
summary(autocc$MTELP)
humcc <-subset(data, Condition == "human_cc")
summary(humcc$MTELP)
nocc <-subset(data, Condition == "no_cc")
summary(nocc$MTELP)
```
Analysis by condition
```{r}

data.plot <-summarySE(data=data,measurevar="Right",groupvars=c("Subject","Condition" ),
                      na.rm=T,conf.interval=0.95)
data.plot <-summarySE(data=data.plot,measurevar="Right",groupvars=c("Condition"),
                      na.rm=T,conf.interval=0.95)
data.plot
```

```{r}
print('auto caption')
summary(autocc)
print('human caption')
summary(humcc)
print('no caption')
summary(nocc)
```
# Model 0
```{r}
data$caption.e<-factor(data$Condition,levels=c("auto_cc", "human_cc", "no_cc"),labels=c("Auto","Human", "None"))
contrasts(data$caption.e)<-contr.sum(3)
contrasts(data$caption.e)



m0<-glmer(Right~(1|Subject)+(1|Question),
          family=binomial,control=glmerControl(optimizer="bobyqa"),data=data)
summary(m0)
```

# Model 1
```{r}
m1<-glmer(Right~caption.e+
            (1|Subject)+(1|Question),
          family=binomial,control=glmerControl(optimizer="bobyqa"),data=data)
summary(m1)
anova(m0,m1) 
anova(m0,m1)[2,2]-anova(m0,m1)[1,2]

```
#Model2
```{r}
m2<-glmer(Right~caption.e+MTELP+
            (1|Subject)+(1|Question),
          family=binomial,control=glmerControl(optimizer="bobyqa"),data=data)
summary(m2)
anova(m1,m2) 
anova(m1,m2)[2,2]-anova(m1,m2)[1,2]

```
#Model3
```{r}
m3<-glmer(Right~caption.e*MTELP+
            (1|Subject)+(1|Question),
          family=binomial,control=glmerControl(optimizer="bobyqa"),data=data)
summary(m3)
anova(m2,m3) 
anova(m2,m3)[2,2]-anova(m2,m3)[1,2]

```

#GRAPHS BY PROFICIENCY
Right prediction by Eng proficiency
```{r}
fit.prova=lm(Right~MTELP+Condition,data=data)
summary(fit.prova)

ggplot(data = data , aes(x=MTELP, y=Right, color = Condition)) +
ylim(0,1)+ylab("Right")+
  xlab("Proficiency")+geom_point()+
  geom_smooth(method=lm)
# Remove confidence intervals
# Extend the regression lines
ggplot(data = data , aes(x=MTELP, y=Right, color = Condition)) +
  ylim(0,1)+ylab("Main effect")+
  xlab("MTELP")+
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE)
```
Analysis by low vs high proficiency
```{r}
lowProf<- subset(data, Level == "Lower")
highProf <- subset(data, Level == "Higher")

summary(lowProf)
summary(highProf)
```

```{r}
#lower proficiency
ggplot(data = lowProf , aes(x=MTELP, y=Right, color = Condition)) +
ylim(0,1)+ylab("Right")+
  xlab("Proficiency")+geom_point()+
  geom_smooth(method=lm)

ggplot(data = lowProf , aes(x=MTELP, y=Right, color = Condition)) +
  ylim(0,1)+ylab("Main effect")+
  xlab("MTELP")+
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE)

#higher proficiency
ggplot(data = highProf , aes(x=MTELP, y=Right, color = Condition)) +
ylim(0,1)+ylab("Right")+
  xlab("Proficiency")+geom_point()+
  geom_smooth(method=lm)
# Remove confidence intervals
# Extend the regression lines
ggplot(data = highProf , aes(x=MTELP, y=Right, color = Condition)) +
  ylim(0,1)+ylab("Main effect")+
  xlab("MTELP")+
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE)
```


Analysis by course + condition
```{r}

BA <- subset(data, Course == "BA")
MA <- subset(data, Course == "MA")

print('BA')
summary(BA)

data.ba <-summarySE(data=BA,measurevar="Right",groupvars=c("Subject","Condition" ),
                      na.rm=T,conf.interval=0.95)
data.ba <-summarySE(data=data.ba,measurevar="Right",groupvars=c("Condition"),
                      na.rm=T,conf.interval=0.95)
data.ba

print("MA")
summary(MA)

data.ma <-summarySE(data=MA,measurevar="Right",groupvars=c("Subject","Condition" ),
                      na.rm=T,conf.interval=0.95)
data.ma <-summarySE(data=data.ma,measurevar="Right",groupvars=c("Condition"),
                      na.rm=T,conf.interval=0.95)
data.ma
```

Right prediction by Course + Eng proficiency + Condition
```{r}

#BA
fit.ba=lm(Right~MTELP+Condition,data=BA)
summary(fit.ba)

ggplot(data = BA , aes(x=MTELP, y=Right, color = Condition)) +
ylim(0,1)+ylab("Right")+
  xlab("Proficiency")+geom_point()+
  geom_smooth(method=lm)
# Remove confidence intervals
# Extend the regression lines
ggplot(data = BA , aes(x=MTELP, y=Right, color = Condition)) +
  ylim(0,1)+ylab("Main effect")+
  xlab("MTELP")+
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE)
```
```{r}
#MA
fit.ma=lm(Right~MTELP+Condition,data=MA)
summary(fit.ma)

ggplot(data = MA , aes(x=MTELP, y=Right, color = Condition)) +
ylim(0,1)+ylab("Right")+
  xlab("Proficiency")+geom_point()+
  geom_smooth(method=lm)
# Remove confidence intervals
# Extend the regression lines
ggplot(data = MA , aes(x=MTELP, y=Right, color = Condition)) +
  ylim(0,1)+ylab("Main effect")+
  xlab("MTELP")+
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE)
```
Analysis by condition + cc use

```{r}
#probably better histo
fit.cc=lm(Right~HabCC,data=data)
summary(fit.cc)

ggplot(data = data , aes(x=MTELP, y=Right, color = HabCC)) +
ylim(0,1)+ylab("Right")+
  xlab("Proficiency")+geom_point()+
  geom_smooth(method=lm)
# Remove confidence intervals
# Extend the regression lines
ggplot(data = data , aes(x=MTELP, y=Right, color = HabCC)) +
  ylim(0,1)+ylab("Main effect")+
  xlab("MTELP")+
  geom_smooth(method=lm, se=FALSE, fullrange=TRUE)


```



Analysis by question + condition
# summary: main effect of human cc 
```{r}
data.plotHum <-summarySE(data=humancc,measurevar="Right",groupvars=c("Question","Subject" ),
                      na.rm=T,conf.interval=0.95)
data.plotHum <-summarySE(data=data.plotHum,measurevar="Right",groupvars=c("Question"),
                      na.rm=T,conf.interval=0.95)
data.plotHum

# plot human 
graph1<-ggplot(data.plotHum,aes(x=Question,y=Right))+
  geom_bar(position=position_dodge(),stat="identity",
           colour="black", # Use black outlines
           size=.3)+ # Thinner lines
  geom_errorbar(aes(ymin=Right-se,ymax=Right+se),
                width=.2,
                position=position_dodge(.9))+
  xlab("Questions")+
  ylab("Proportion of correct human captions responses")+
  guides(fill=F)+
  ylim(0,1)+
  theme_set(theme_bw(base_size=12))

# prune graph/add asterisks (500*400)
graph1+theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"))


# summary: main effect of automatic cc
data.plotAuto <-summarySE(data=autocc,measurevar="Right",groupvars=c("Question","Subject" ),
                      na.rm=T,conf.interval=0.95)
data.plotAuto <-summarySE(data=data.plotAuto,measurevar="Right",groupvars=c("Question"),
                      na.rm=T,conf.interval=0.95)
data.plotAuto

# plot auto
graph1<-ggplot(data.plotAuto,aes(x=Question,y=Right))+
  geom_bar(position=position_dodge(),stat="identity",
           colour="black", # Use black outlines
           size=.3)+ # Thinner lines
  geom_errorbar(aes(ymin=Right-se,ymax=Right+se),
                width=.2,
                position=position_dodge(.9))+
  xlab("Qs number")+
  ylab("Proportion of correct auto captions responses")+
  guides(fill=F)+
  ylim(0,1)+
  theme_set(theme_bw(base_size=12))

# prune graph/add asterisks (500*400)
graph1+theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"))



# summary: main effect of automatic cc

data.plotNone <-summarySE(data = nocc, measurevar="Right",groupvars=c("Question","Subject"),
                      na.rm=T,conf.interval=0.95)
data.plotNone <-summarySE(data=data.plotNone,measurevar="Right",groupvars=c("Question"),
                      na.rm=T,conf.interval=0.95)
data.plotNone

# plot no cc
graph1<-ggplot(data.plotNone, aes(x=Question,y=Right))+
  geom_bar(position=position_dodge(),stat="identity",
           colour= "Black", # Use black outlines
           size=.3)+ # Thinner lines
  geom_errorbar(aes(ymin=Right-se,ymax=Right+se),
                width=.2,
                position=position_dodge(.9))+
  xlab("Qs number")+
  ylab("Proportion of correct no captions responses")+
  guides(fill=F)+
  ylim(0,1)+
  theme_set(theme_bw(base_size=12))

# prune graph/add asterisks (500*400)
graph1+theme(panel.grid.major=element_blank(),
        panel.grid.minor=element_blank(),
        axis.line=element_line(colour="black"))

# Summary: comparison between conditions

data.plot <-summarySE(data=data,measurevar="Right",groupvars=c("Question","Condition" ),
                      na.rm=T,conf.interval=0.95)
data.plot <-summarySE(data=data.plot,measurevar="Right",groupvars=c("Question","Condition"),
                      na.rm=T,conf.interval=0.95)
data.plot

 
data.plot %>% 
  ggplot(aes(x = Question, y = Right, 
             fill = Condition)) +
  geom_col(position = position_dodge())


```
